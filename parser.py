import aiohttp

# –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å –µ–≤—Ä–æ –∫ —Ä—É–±–ª—é —Å —Å–∞–π—Ç–∞ –¶–ë –†–§
async def get_eur_to_rub_rate():
    url = 'https://www.cbr-xml-daily.ru/daily_json.js'
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            if response.status == 200:
                data = await response.json(content_type=None)  # <--- –¥–æ–±–∞–≤–∏–ª content_type=None —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏!
                eur_rate = data['Valute']['EUR']['Value']  # –¶–µ–Ω–∞ 1 –µ–≤—Ä–æ –≤ —Ä—É–±–ª—è—Ö
                return eur_rate
            else:
                raise Exception(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç: {response.status}")

# –¢–∞—Ä–∏—Ñ—ã –≤ —Ä—É–±–ª—è—Ö
TARIFFS_RUB = {
    "<36.8 –∫–í—Ç / 50 –ª—Å": [1241.46, 2280.79, 3041.05, 3801.31, 5321.84, 7602.63],
    "36.8-51.5 –∫–í—Ç / 50-70 –ª—Å": [2069.10, 3801.31, 5068.42, 6335.52, 8869.73, 12671.04],
    "51.5-73,6 –∫–í—Ç / 70-100 –ª—Å": [2276.01, 4181.44, 5575.26, 6969.07, 9756.70, 13938.15],
    "73,6-88,3 –∫–í—Ç / 100-120 –ª—Å": [2482.92, 4561.58, 6082.10, 7602.63, 10643.68, 15205.25],
    "88,3-110,3 –∫–í—Ç / 120-150 –ª—Å": [2896.74, 5321.84, 7095.78, 8869.73, 12417.62, 17739.46],
    "> 110.3 –∫–í—Ç / 150 –ª—Å": [3310.56, 6082.10, 8109.47, 10136.84, 14191.57, 20273.67],
    "–ì—Ä—É–∑–æ–≤–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –ö–∞—Ç. –°": [3312.56, 4968.83, 6625.11, 8281.39, 11593.95, 16562.78]
}

# –ü–µ—Ä–µ–≤–æ–¥–∏–º —Ç–∞—Ä–∏—Ñ—ã –≤ –µ–≤—Ä–æ –∏ –≥–æ—Ç–æ–≤–∏–º —Ç–µ–∫—Å—Ç
async def get_osago_prices():
    try:
        eur_rate = await get_eur_to_rub_rate()
        prices_text = "üí∞ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –û–°–ê–ì–û (–≤ –µ–≤—Ä–æ):\n\n"
        for power, rub_prices in TARIFFS_RUB.items():
            prices_text += f"‚ñ™Ô∏è –ú–æ—â–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—è: **{power}**\n"
            periods = ["15 –¥–Ω–µ–π", "1 –º–µ—Å—è—Ü", "2 –º–µ—Å—è—Ü–∞", "3 –º–µ—Å—è—Ü–∞", "6 –º–µ—Å—è—Ü–µ–≤", "12 –º–µ—Å—è—Ü–µ–≤"]
            
            for period, rub_price in zip(periods, rub_prices):
                euro_price = round(rub_price / eur_rate)  # –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ
                prices_text += f"üìÖ {period} ‚Äî **{euro_price} ‚Ç¨**\n"  # –±–µ–∑ .2f
            
            prices_text += "\n"
        
        prices_text += "‚úÖ –ö—É—Ä—Å –≤–∞–ª—é—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.\n"
        prices_text += "–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç](https://augapost.com/ru/osago)"

        return prices_text
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {str(e)}"
